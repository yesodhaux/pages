<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitor de Código de Barras</title>
    <script src="https://cdn.jsdelivr.net/npm/barcode-qrcode-reader@1.0.3/dist/barcode-qrcode-reader.min.js"></script>
</head>
<body>
    <h1>Leitor de Código de Barras e QR Code</h1>
    <button id="startScan">Iniciar Escaneamento</button>
    <div>
        <video id="video" width="300" height="200" style="border: 1px solid #000;"></video>
    </div>
    <p>Resultado: <span id="result"></span></p>

    <script>
        // Função para iniciar o escaneamento
        document.getElementById("startScan").addEventListener("click", function() {
            const videoElement = document.getElementById("video");

            // Usando o mediaDevices para acessar a câmera (preferencialmente traseira)
            navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: "environment" // Preferindo a câmera traseira
                }
            }).then(function(stream) {
                // Conectando o stream da câmera ao elemento de vídeo
                videoElement.srcObject = stream;
                videoElement.play();

                // Inicializando o scanner
                const scanner = new BarcodeQRCodeReader();
                scanner.onDecode = function(result) {
                    // Exibindo o resultado da leitura do código
                    document.getElementById("result").textContent = result;
                };

                // Função para fazer a leitura contínua do vídeo
                function scanVideo() {
                    scanner.decodeFromVideoElement(videoElement).then(() => {
                        // Continuar a escanear
                        requestAnimationFrame(scanVideo);
                    }).catch(err => {
                        // Lidar com erros de leitura
                        console.log("Erro ao tentar ler código:", err);
                    });
                }

                // Iniciando o escaneamento contínuo
                scanVideo();

            }).catch(function(error) {
                alert("Erro ao acessar a câmera: " + error.message);
            });
        });
    </script>
</body>
</html>
